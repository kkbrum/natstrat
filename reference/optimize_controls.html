<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Select control units that optimize covariate balance — optimize_controls • natstrat</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Select control units that optimize covariate balance — optimize_controls"><meta property="og:description" content="Select control units within strata that optimize covariate balance.
Uses randomized rounding of a linear program or a mixed
integer linear program."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">natstrat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../articles/natstrat.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://github.com/kkbrum/natstrat/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Select control units that optimize covariate balance</h1>
    <small class="dont-index">Source: <a href="https://github.com/kkbrum/natstrat/blob/HEAD/R/optimize_controls.R" class="external-link"><code>R/optimize_controls.R</code></a></small>
    <div class="hidden name"><code>optimize_controls.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Select control units within strata that optimize covariate balance.
Uses randomized rounding of a linear program or a mixed
integer linear program.</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="fu">optimize_controls</span><span class="op">(</span>
  <span class="va">z</span>,
  <span class="va">X</span>,
  <span class="va">st</span>,
  importances <span class="op">=</span> <span class="cn">NULL</span>,
  treated <span class="op">=</span> <span class="fl">1</span>,
  ratio <span class="op">=</span> <span class="cn">NULL</span>,
  q_s <span class="op">=</span> <span class="cn">NULL</span>,
  treated_star <span class="op">=</span> <span class="cn">NULL</span>,
  q_star_s <span class="op">=</span> <span class="cn">NULL</span>,
  weight_star <span class="op">=</span> <span class="fl">1</span>,
  integer <span class="op">=</span> <span class="cn">FALSE</span>,
  solver <span class="op">=</span> <span class="st">"Rglpk"</span>,
  seed <span class="op">=</span> <span class="cn">NULL</span>,
  runs <span class="op">=</span> <span class="fl">1</span>,
  time_limit <span class="op">=</span> <span class="cn">Inf</span>,
  threads <span class="op">=</span> <span class="fl">1</span>,
  correct_sizes <span class="op">=</span> <span class="cn">TRUE</span>,
  low_memory <span class="op">=</span> <span class="cn">FALSE</span>
<span class="op">)</span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>z</dt>
<dd><p>a factor with the <code>i</code>th entry equal to the treatment of unit <code>i</code>.</p></dd>
<dt>X</dt>
<dd><p>a matrix or data frame containing constraints in the columns. The number
of rows should equal the length of <code>z</code>. Balance is achieved when a constraint
sums to 0, such that numbers closer to 0 are better. When a constraint
does not apply to a particular unit, the entry should be <code>NA</code>.
This should typically be generated using <code><a href="generate_constraints.html">generate_constraints</a>()</code>.</p></dd>
<dt>st</dt>
<dd><p>a stratum vector with the <code>i</code>th entry equal to the
stratum of unit <code>i</code>. This should have the same order of units and length
as <code>z</code>.</p></dd>
<dt>importances</dt>
<dd><p>a vector with length equal to the number of constraints or columns
in <code>X</code>. This can be generated using <code><a href="generate_constraints.html">generate_constraints</a>()</code> and each nonnegative value
denotes how much to prioritize each constraint, with the default being 1
for all constraints.</p></dd>
<dt>treated</dt>
<dd><p>which treatment value should be considered the treated units. This
must be one of the values of <code>z</code>.</p></dd>
<dt>ratio</dt>
<dd><p>a numeric or vector specifying the desired ratio of controls to `treated` in
each stratum. If there is one control group and all treated units should be included,
this can be a numeric. Otherwise, this should be
a vector with one entry per treatment group, in the same order as the levels of
<code>z</code>, including the treated level. If <code>NULL</code>, <code>q_s</code> should be specified.</p></dd>
<dt>q_s</dt>
<dd><p>a named vector or matrix indicating how many units are to be selected from each stratum.
If there is one control group and all treated units are desired, this can be a vector; otherwise,
this should have one row per treatment group, where the order of the rows matches the order of
the levels of <code>z</code>, including the treated level.
If <code>NULL</code>, <code>ratio</code> should be specified. If both are specified, <code>q_s</code> will take priority.
Typically, if the desired ratio is not feasible for every stratum, <code>q_s</code> should be generated
using <code><a href="generate_qs.html">generate_qs</a>()</code>.</p></dd>
<dt>treated_star</dt>
<dd><p>which treatment value should be considered the treated units
for the supplemental comparison. This
must be one of the values of <code>z</code>.
 If multiple supplemental comparisons are desired, this should be a vector with one entry per supplemental
  comparison.</p></dd>
<dt>q_star_s</dt>
<dd><p>a named vector or matrix,
indicating how many supplemental units are to be selected from each stratum.
The matrix should have one row per treatment group, where the order of the rows matches the order of
the levels of <code>z</code>, including the treated level.
If multiple supplemental comparisons are desired, this should be a list with one entry per supplemental
comparison.</p></dd>
<dt>weight_star</dt>
<dd><p>a numeric stating how much to prioritize balance between the supplemental units as
compared to balance between the main units.
  If multiple supplemental comparisons are desired, this should be a vector with one entry per supplemental
  comparison.</p></dd>
<dt>integer</dt>
<dd><p>a logical stating whether to use a mixed integer programming solver
instead of randomized rounding. Default is <code>FALSE</code>.</p></dd>
<dt>solver</dt>
<dd><p>a character stating which solver to use to run the linear program.
Options are "Rglpk" (default) or "gurobi". You must have the 'gurobi' package
installed to use the "gurobi" option. If available, this is the recommended solver.</p></dd>
<dt>seed</dt>
<dd><p>the seed to use when doing the randomized rounding of the linear program.
This will allow results to be reproduced if desired. The default is <code>NULL</code>,
which will choose a random seed to use and return.</p></dd>
<dt>runs</dt>
<dd><p>the number of times to run randomized rounding of the linear solution.
The objective values of all runs will be reported, but the detailed results
will only be reported for the run with the lowest objective value. The default is 1.</p></dd>
<dt>time_limit</dt>
<dd><p>numeric stating maximum amount of seconds for which the
program is allowed to run before aborting. Default is <code>Inf</code> for no time limit.</p></dd>
<dt>threads</dt>
<dd><p>The maximum number of threads that should be used. This is only
applicable if <code>solver = 'gurobi'</code>.</p></dd>
<dt>correct_sizes</dt>
<dd><p>boolean stating whether the desired sample sizes should
be exactly correct (if <code>correct_sizes = TRUE</code>) or only need to be correct
in expectation. For multiple comparisons, sample sizes may only be
correct in expectation.</p></dd>
<dt>low_memory</dt>
<dd><p>boolean stating whether some outputs should not be included
due to the scale of the problem being too large compared to memory space.
If <code>TRUE</code>, <code>eps</code> and <code>eps_star</code> will not be reported. Imbalances
can be computed post hoc using the <code><a href="check_balance.html">check_balance</a>()</code> instead.</p></dd>
</dl></div>
    <div id="value">
    <h2>Value</h2>
    <p>List containing:</p><dl><dt><code>objective</code></dt>
<dd><p>objective value of the randomized rounding or mixed integer
    linear program solution.</p></dd>

  <dt><code>objective_wo_importances</code></dt>
<dd><p>objective value of the randomized rounding or mixed integer
    linear program solution not weighted by the variable importances.</p></dd>

  <dt><code>eps</code></dt>
<dd><p>the amount of imbalance obtained in each constraint from the linear program.
  The row names specify the covariate, the population of interest, and, if there are
  more than two comparison groups, which groups are being compared.</p></dd>

  <dt><code>eps_star</code></dt>
<dd><p>same as <code>eps</code> but for the supplemental units instead of the units
  in the main comparison. If there are multiple supplemental comparisons, this is a list.
  If there are none, this is <code>NULL</code>.</p></dd>

  <dt><code>importances</code></dt>
<dd><p>the importance of each on the balance constraints.</p></dd>

  <dt><code>weight_star</code></dt>
<dd><p>the importance of balancing in the supplemental comparison
  relative to the main comparison. If there are multiple supplemental comparisons,
  this is a vector. If there are none, this is <code>NULL</code>.</p></dd>

  <dt><code>selected</code></dt>
<dd><p>whether each unit was selected for the main comparison.</p></dd>

  <dt><code>selected_star</code></dt>
<dd><p>whether each unit was selected for the supplement.
  If there are multiple supplemental comparisons, this is a list.
  If there are none, this is <code>NULL</code>.</p></dd>

  <dt><code>pr</code></dt>
<dd><p>the linear program weight assigned to each unit for the main comparison.</p></dd>

  <dt><code>pr_star</code></dt>
<dd><p>the linear program weight assigned to each unit for the supplement.
  If there are multiple supplemental comparisons, this is a list.
  If there are none, this is <code>NULL</code>.</p></dd>

  <dt><code>rrdetails</code></dt>
<dd><p>A list containing:</p><dl><dt><code>seed</code></dt>
<dd><p>the seed used before commencing the random sampling.</p></dd>

  <dt><code>run_objectives</code></dt>
<dd><p>the objective values for each run of randomized rounding.</p></dd>

  <dt><code>run_objectives_wo_importances</code></dt>
<dd><p>the objective values for each run of randomized rounding,
  not scaled by constraint importances.</p></dd>

  
</dl></dd>

  <dt><code>lpdetails</code></dt>
<dd><p>the full return of the function <code><a href="https://rdrr.io/pkg/Rglpk/man/Rglpk_solve.html" class="external-link">Rglpk_solve_LP</a>()</code>
    or <code>gurobi()</code> plus information about the epsilons and objective values
    for the linear program solution.</p></dd>


</dl></div>

    <div id="ref-examples">
    <h2>Examples</h2>
    <div class="sourceCode"><pre class="sourceCode r"><code>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'nh0506'</span><span class="op">)</span>

<span class="co"># Create strata</span>
<span class="va">age_cat</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">nh0506</span><span class="op">$</span><span class="va">age</span>,
               breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">39</span>, <span class="fl">50</span>, <span class="fl">85</span><span class="op">)</span>,
               labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'&lt; 40 years'</span>, <span class="st">'40 - 50 years'</span>, <span class="st">'&gt; 50 years'</span><span class="op">)</span><span class="op">)</span>
<span class="va">strata</span> <span class="op">&lt;-</span> <span class="va">age_cat</span> <span class="op">:</span> <span class="va">nh0506</span><span class="op">$</span><span class="va">sex</span>

<span class="co"># Balance age, race, education, poverty ratio, and bmi both across and within the levels of strata</span>
<span class="va">constraints</span> <span class="op">&lt;-</span> <span class="fu"><a href="generate_constraints.html">generate_constraints</a></span><span class="op">(</span>
                 balance_formulas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">povertyr</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">strata</span><span class="op">)</span>,
                 z <span class="op">=</span> <span class="va">nh0506</span><span class="op">$</span><span class="va">z</span>,
                 data <span class="op">=</span> <span class="va">nh0506</span><span class="op">)</span>

<span class="co"># Choose one control for every treated unit in each stratum,</span>
<span class="co"># balancing the covariates as described by the constraints</span>
<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">optimize_controls</span><span class="op">(</span>z <span class="op">=</span> <span class="va">nh0506</span><span class="op">$</span><span class="va">z</span>,
                             X <span class="op">=</span> <span class="va">constraints</span><span class="op">$</span><span class="va">X</span>,
                             st <span class="op">=</span> <span class="va">strata</span>,
                             importances <span class="op">=</span> <span class="va">constraints</span><span class="op">$</span><span class="va">importances</span>,
                             ratio <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>

<span class="co"># If you want to use a ratio that's not feasible,</span>
<span class="co"># you can supply a vector of the desired number of controls per stratum, q_s,</span>
<span class="co"># typically generated by creating a distance matrix between strata and using</span>
<span class="co"># generate_qs():</span>

<span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
<span class="va">age_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
                   nrow <span class="op">=</span> <span class="fl">3</span>,
                   byrow <span class="op">=</span> <span class="cn">TRUE</span>,
                   dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">age_cat</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">sex_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span>,
                   nrow <span class="op">=</span> <span class="fl">2</span>,
                   dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">nh0506</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">nh0506</span><span class="op">$</span><span class="va">sex</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">strata_dist</span> <span class="op">&lt;-</span> <span class="fu"><a href="create_dist_matrix.html">create_dist_matrix</a></span><span class="op">(</span><span class="va">age_dist</span>, <span class="va">sex_dist</span><span class="op">)</span>

<span class="va">qs</span> <span class="op">&lt;-</span> <span class="fu"><a href="generate_qs.html">generate_qs</a></span><span class="op">(</span>z <span class="op">=</span> <span class="va">nh0506</span><span class="op">$</span><span class="va">z</span>,
                  st <span class="op">=</span> <span class="va">strata</span>,
                  ratio <span class="op">=</span> <span class="fl">2.5</span>,
                  max_ratio <span class="op">=</span> <span class="fl">2.6</span>,
                  max_extra_s <span class="op">=</span> <span class="fl">0</span>,
                  strata_dist <span class="op">=</span> <span class="va">strata_dist</span><span class="op">)</span>

<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">optimize_controls</span><span class="op">(</span>z <span class="op">=</span> <span class="va">nh0506</span><span class="op">$</span><span class="va">z</span>,
                             X <span class="op">=</span> <span class="va">constraints</span><span class="op">$</span><span class="va">X</span>,
                             st <span class="op">=</span> <span class="va">strata</span>,
                             importances <span class="op">=</span> <span class="va">constraints</span><span class="op">$</span><span class="va">importances</span>,
                             q_s <span class="op">=</span> <span class="va">qs</span><span class="op">)</span>

<span class="op">}</span>

<span class="co"># We can also have multiple treatment and control groups,</span>
<span class="co"># as well as multiple simultaneous comparisons:</span>

<span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">'nh0506_3groups'</span><span class="op">)</span>
<span class="va">strata2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cut.html" class="external-link">cut</a></span><span class="op">(</span><span class="va">nh0506_3groups</span><span class="op">$</span><span class="va">age</span>, breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">19</span>, <span class="fl">39</span>, <span class="fl">50</span>, <span class="fl">85</span><span class="op">)</span>,
              labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'&lt; 40 years'</span>, <span class="st">'40 - 50 years'</span>, <span class="st">'&gt; 50 years'</span><span class="op">)</span><span class="op">)</span>
<span class="va">constraints2</span> <span class="op">&lt;-</span> <span class="fu"><a href="generate_constraints.html">generate_constraints</a></span><span class="op">(</span>
  balance_formulas <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="va">age</span> <span class="op">+</span> <span class="va">race</span> <span class="op">+</span> <span class="va">education</span> <span class="op">+</span> <span class="va">povertyr</span> <span class="op">+</span> <span class="va">bmi</span> <span class="op">+</span> <span class="va">sex</span> <span class="op">~</span> <span class="fl">1</span> <span class="op">+</span> <span class="va">strata2</span><span class="op">)</span>,
  z <span class="op">=</span> <span class="va">nh0506_3groups</span><span class="op">$</span><span class="va">z</span>,
  data <span class="op">=</span> <span class="va">nh0506_3groups</span>,
  treated <span class="op">=</span> <span class="st">'daily smoker'</span><span class="op">)</span>
<span class="va">q_star_s</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">nh0506_3groups</span><span class="op">$</span><span class="va">z</span>, <span class="va">strata2</span><span class="op">)</span><span class="op">[</span><span class="st">'some smoking'</span>, <span class="op">]</span> <span class="op">-</span>
                           <span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">nh0506_3groups</span><span class="op">$</span><span class="va">z</span>, <span class="va">strata2</span><span class="op">)</span><span class="op">[</span><span class="st">'daily smoker'</span>, <span class="op">]</span>, <span class="fl">2</span><span class="op">)</span>,
                     <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">3</span><span class="op">)</span><span class="op">)</span>, byrow <span class="op">=</span> <span class="cn">TRUE</span>, nrow <span class="op">=</span> <span class="fl">3</span>,
                   dimnames <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">nh0506_3groups</span><span class="op">$</span><span class="va">z</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/levels.html" class="external-link">levels</a></span><span class="op">(</span><span class="va">strata2</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="va">results</span> <span class="op">&lt;-</span> <span class="fu">optimize_controls</span><span class="op">(</span>z <span class="op">=</span> <span class="va">nh0506_3groups</span><span class="op">$</span><span class="va">z</span>,
                             X <span class="op">=</span> <span class="va">constraints2</span><span class="op">$</span><span class="va">X</span>,
                             importances <span class="op">=</span> <span class="va">constraints2</span><span class="op">$</span><span class="va">importances</span>,
                             st <span class="op">=</span> <span class="va">strata2</span>,
                             ratio <span class="op">=</span> <span class="fl">1</span>,
                             treated <span class="op">=</span> <span class="st">'daily smoker'</span>,
                             treated_star <span class="op">=</span> <span class="st">'some smoking'</span>,
                             q_star_s <span class="op">=</span> <span class="va">q_star_s</span>,
                             correct_sizes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>

<span class="op">}</span>
</code></pre></div>
    </div>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Katherine Brumberg.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.2.</p>
</div>

      </footer></div>

  


  

  </body></html>

