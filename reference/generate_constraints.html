<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Generate constraints to encourage covariate balance — generate_constraints • natstrat</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Generate constraints to encourage covariate balance — generate_constraints" />
<meta property="og:description" content="This function generates constraints that encourage covariate balance as specified.
The main inputs are formula like objects, where the left hand side indicates
the covariate to be balanced and the right hand side indicates the
groups within which to balance. The constraints are
weighted and standardized by stand() to be used in optimize_controls(). Missingness
indicators can also be added and weighted for any covariate that has NA values." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">natstrat</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/natstrat.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/kkbrum/natstrat/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Generate constraints to encourage covariate balance</h1>
    <small class="dont-index">Source: <a href='https://github.com/kkbrum/natstrat/blob/master/R/generate_constraints.R'><code>R/generate_constraints.R</code></a></small>
    <div class="hidden name"><code>generate_constraints.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This function generates constraints that encourage covariate balance as specified.
The main inputs are formula like objects, where the left hand side indicates
the covariate to be balanced and the right hand side indicates the
groups within which to balance. The constraints are
weighted and standardized by <code><a href='stand.html'>stand</a>()</code> to be used in <code><a href='optimize_controls.html'>optimize_controls</a>()</code>. Missingness
indicators can also be added and weighted for any covariate that has <code>NA</code> values.</p>
    </div>

    <pre class="usage"><span class='fu'>generate_constraints</span><span class='op'>(</span>
  <span class='va'>balance_formulas</span>,
  <span class='va'>z</span>,
  <span class='va'>data</span>,
  default_rhs <span class='op'>=</span> <span class='cn'>NULL</span>,
  weight_by_size <span class='op'>=</span> <span class='fl'>0</span>,
  denom_variance <span class='op'>=</span> <span class='st'>"treated"</span>,
  autogen_missing <span class='op'>=</span> <span class='fl'>50</span>
<span class='op'>)</span></pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>balance_formulas</th>
      <td><p>a list of formulas where the left hand side represents
the covariate to be balanced, and the terms on the right hand side represent
the groups within which the covariate should be balanced. More information can
be found in the details below.</p></td>
    </tr>
    <tr>
      <th>z</th>
      <td><p>a treatment indicator vector with <code>i</code>th entry equal to 0 if
unit <code>i</code> is a control and equal to 1 if unit <code>i</code> is treated.</p></td>
    </tr>
    <tr>
      <th>data</th>
      <td><p>a data frame containing the relevant covariates in the columns. The number
of rows should equal the length of <code>treated</code>.</p></td>
    </tr>
    <tr>
      <th>default_rhs</th>
      <td><p>the list of <code>balance_formulas</code> can also contain entries
that are just the character corresponding to a covariate to balance. If so,
the covariate will be balanced according to <code>default_rhs</code>.</p></td>
    </tr>
    <tr>
      <th>weight_by_size</th>
      <td><p>numeric between 0 and 1 stating how to adjust constraints
for the size of the groups they represent. Default is 0, meaning imbalance
within groups is viewed in absolute terms, not relative to the group size.
The program may thus prioritize
balancing the covariate in larger groups compared to smaller groups. A value
of 1 means that imbalance will be measured relative to the group's size, not
in absolute terms, implying that it is equally important to balance in every group.</p></td>
    </tr>
    <tr>
      <th>denom_variance</th>
      <td><p>character stating what variance to use in the standardization:
either the default "treated", meaning the standardization will use the
treated variance (across all strata), or "pooled", meaning
the standardization will use the average of the treated and control variances.</p></td>
    </tr>
    <tr>
      <th>autogen_missing</th>
      <td><p>whether to automatically generate missingness constraints
and how heavily to prioritize them. Should be a numeric
or <code>NULL</code>. <code>NULL</code> indicates that
constraints to balance the rate of missingness (denoted by <code>NA</code>s
in <code>data</code>) should not be automatically generated. Note that this is not
recommended unless the user has already accounted for missing values.
If not <code>NULL</code>, <code>autogen_missing</code> should be a numeric stating how heavily
to prioritize generated missingness constraints over covariate constraints.
The default is 50.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list with two named components:</p><dl>
  <dt><code>X</code></dt><dd><p>a matrix with constraints as columns and the same number of rows as the inputs.
  The column names provide information about the constraints, including the covariate
  names and the factor and level to which it pertains.</p></dd>
  <dt><code>importances</code></dt><dd><p>a named vector with names corresponding to the constraint names
  and values corresponding to how heavily that constraint should be prioritized,
  based on the information provided through <code>balance_formulas</code>, <code>weight_by_size</code>,
  and <code>autogen_missing</code>.</p></dd>
  
</dl>

    <h2 class="hasAnchor" id="details"><a class="anchor" href="#details"></a>Details</h2>

    

<p>The <code>balance_formulas</code> argument can include formulas beyond those interpreted
  by <code>R</code> to be <code>formulas</code>. Their interpretation is also different, as
  explained below:</p>
<dl>
<dt>Left hand side</dt><dd><p>The left hand side of the formula contains the covariate
  to be balanced. It can also be the sum of multiple covariates, in which case
  each term will be balanced individually according to the right hand side. Additionally,
  '.' on the left hand side will designate that all covariates in <code>data</code>
  should be balanced according to the designated or default right hand side
  (as usual, terms may be subtracted to remove them).</p></dd>
<dt>Right hand side</dt><dd><p>The right hand side should be the sum of factor, character,
  or boolean variables. The covariate of the left hand side will be balanced within
  each level of each term on the right hand side. The right hand side can also
  contain '.', meaning the covariate will be balanced across all levels of all
  categorical, character, or boolean variables found in <code>data</code> (as usual,
  terms may be subtracted to remove them). In the most common case, the user
  will have one term on the right hand side consisting of the strata within
  which balance in desired.</p></dd>
<dt>Coefficients</dt><dd><p>The formulas can contain coefficients specifying how much
  to weight a certain set of constraints. Coefficients of the left hand side terms will
  weight all constraints generated for that covariate, and coefficients of the
  right hand side will weight the constraints generated for each level of that
  term.</p></dd>
<dt>Intercept</dt><dd><p>The intercept term, 1, is automatically included on the right
  hand side of the formula, and designates that the covariate of the left hand side
  will be balanced across all control units. You may enter a different numeric &gt; 0
  that will signify how much to weight the constraint, or you may enter "- 1" or "+ 0"
  to remove the intercept and its associated constraint, as per usual.</p></dd>
</dl>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='st'>'nh0506'</span><span class='op'>)</span>

<span class='co'># Create strata</span>
<span class='va'>age_cat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/cut.html'>cut</a></span><span class='op'>(</span><span class='va'>nh0506</span><span class='op'>$</span><span class='va'>age</span>,
               breaks <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>19</span>, <span class='fl'>39</span>, <span class='fl'>50</span>, <span class='fl'>85</span><span class='op'>)</span>,
               labels <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='st'>'&lt; 40 years'</span>, <span class='st'>'40 - 50 years'</span>, <span class='st'>'&gt; 50 years'</span><span class='op'>)</span><span class='op'>)</span>
<span class='va'>strata</span> <span class='op'>&lt;-</span> <span class='va'>age_cat</span> <span class='op'>:</span> <span class='va'>nh0506</span><span class='op'>$</span><span class='va'>sex</span>

<span class='co'># Balance age, race, education, poverty ratio, and bmi both across and within the levels of strata</span>
<span class='va'>constraints</span> <span class='op'>&lt;-</span> <span class='fu'>generate_constraints</span><span class='op'>(</span>
                 balance_formulas <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>age</span> <span class='op'>+</span> <span class='va'>race</span> <span class='op'>+</span> <span class='va'>education</span> <span class='op'>+</span> <span class='va'>povertyr</span> <span class='op'>+</span> <span class='va'>bmi</span> <span class='op'>~</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='va'>strata</span><span class='op'>)</span>,
                 z <span class='op'>=</span> <span class='va'>nh0506</span><span class='op'>$</span><span class='va'>z</span>,
                 data <span class='op'>=</span> <span class='va'>nh0506</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in eval(predvars, data, env): object 'strata' not found</span></div><div class='input'>
<span class='co'># Balance age and race both across and within the levels of strata,</span>
<span class='co'># with balance for race being prioritized twice as much as for age,</span>
<span class='co'># and balance across strata prioritized twice as much as within.</span>
<span class='co'># Balance education across and within strata,</span>
<span class='co'># with balance within strata prioritized twice as much as across.</span>
<span class='co'># Balance poverty ratio and bmi only within the levels of strata,</span>
<span class='co'># as specified in the default_rhs argument</span>
<span class='va'>constraints</span> <span class='op'>&lt;-</span> <span class='fu'>generate_constraints</span><span class='op'>(</span>
                 balance_formulas <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span><span class='op'>(</span><span class='va'>age</span> <span class='op'>+</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='va'>race</span> <span class='op'>~</span> <span class='fl'>2</span> <span class='op'>+</span> <span class='va'>strata</span>,
                                         <span class='va'>education</span> <span class='op'>~</span> <span class='fl'>1</span> <span class='op'>+</span> <span class='fl'>2</span> <span class='op'>*</span> <span class='va'>strata</span>,
                                         <span class='st'>'povertyr'</span>,
                                         <span class='st'>'bmi'</span><span class='op'>)</span>,
                 z <span class='op'>=</span> <span class='va'>nh0506</span><span class='op'>$</span><span class='va'>z</span>,
                 data <span class='op'>=</span> <span class='va'>nh0506</span>,
                 default_rhs <span class='op'>=</span> <span class='st'>'0 + strata'</span><span class='op'>)</span>
</div><div class='output co'>#&gt; <span class='error'>Error in eval(predvars, data, env): object 'strata' not found</span></div><div class='input'>
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Katherine Brumberg.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


